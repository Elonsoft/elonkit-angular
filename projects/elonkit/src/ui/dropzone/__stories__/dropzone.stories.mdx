import { Meta, Story, Props } from '@storybook/addon-docs/blocks';
import { Preview } from '~storybook/components';

import { withA11y } from '@storybook/addon-a11y';
import { action } from '@storybook/addon-actions';
import { withKnobs, text, number, select } from '@storybook/addon-knobs';

import { BrowserAnimationsModule } from '@angular/platform-browser/animations';

import { ESDropzoneComponent } from '..';

import {
  DropzoneStoryBasicModule,
  DropzoneStoryBasicComponent,
  DROPZONE_STORY_BASIC_SOURCE
} from './dropzone-story-basic';

import {
  DropzoneStoryRequiredModule,
  DropzoneStoryRequiredComponent,
  DROPZONE_STORY_REQUIRED_SOURCE
} from './dropzone-story-required';

import {
  DropzoneStoryCustomIconModule,
  DropzoneStoryCustomIconComponent,
  DROPZONE_STORY_CUSTOM_ICON_SOURCE
} from './dropzone-story-custom-icon';

import {
  DropzoneStoryLocaleModule,
  DropzoneStoryLocaleComponent,
  DROPZONE_STORY_LOCALE_SOURCE
} from './dropzone-story-locale';

import {
  DropzoneStoryTypographyModule,
  DropzoneStoryTypographyComponent,
  DROPZONE_STORY_TYPOGRAPHY_SOURCE
} from './dropzone-story-typography';

<Meta title='UI/Dropzone' decorators={[withA11y, withKnobs]} />

# Dropzone

This component allows to select files on click or by drag and drop.

## Demos

Validation errors are emitted from `validate` output as array of `ESDropzoneValidationError`.

<Preview source={DROPZONE_STORY_BASIC_SOURCE}>
  <Story name='Basic' height='150px'>
    {{
      component: DropzoneStoryBasicComponent,
      moduleMetadata: {
        imports: [BrowserAnimationsModule, DropzoneStoryBasicModule]
      },
      props: {
        heading: text('heading', 'CHOOSE FILES'),
        subheading: text('subheading', 'or drag files in this area (max size: 50 MB)'),
        accept: text('accept', 'image/png,image/jpg,image/jpeg'),
        maxSize: number('maxSize', '50'),
        type: select('type', { base64: 'base64', binary: 'binary' }, 'binary'),
        changeFiles: action('change'),
        validate: action('errors')
      }
    }}
  </Story>
</Preview>

We can make Control required by adding a Validator.

<Preview source={DROPZONE_STORY_REQUIRED_SOURCE}>
  <Story name='Required' height='200px'>
    {{
      component: DropzoneStoryRequiredComponent,
      moduleMetadata: {
        imports: [BrowserAnimationsModule, DropzoneStoryRequiredModule]
      }
    }}
  </Story>
</Preview>

We can pass `svgIcon` to use custom upload icon.

<Preview source={DROPZONE_STORY_CUSTOM_ICON_SOURCE}>
  <Story name='Custom Icon' height='200px'>
    {{
      component: DropzoneStoryCustomIconComponent,
      moduleMetadata: {
        imports: [BrowserAnimationsModule, DropzoneStoryCustomIconModule]
      }
    }}
  </Story>
</Preview>

We can override default locale which is used for Snackbar messages.

<Preview source={DROPZONE_STORY_LOCALE_SOURCE}>
  <Story name='Locale' height='200px'>
    {{
      component: DropzoneStoryLocaleComponent,
      moduleMetadata: {
        imports: [BrowserAnimationsModule, DropzoneStoryLocaleModule]
      }
    }}
  </Story>
</Preview>

We can use typography inputs in order to change text presentation.

<Preview source={DROPZONE_STORY_TYPOGRAPHY_SOURCE}>
  <Story name='Typography' height='200px'>
    {{
      component: DropzoneStoryTypographyComponent,
      moduleMetadata: {
        imports: [BrowserAnimationsModule, DropzoneStoryTypographyModule]
      }
    }}
  </Story>
</Preview>

## API

<Props of={ESDropzoneComponent} />

## Interfaces

```ts
interface ESDropzoneFile {
  id?: number;
  type?: string;
  base64?: string;
  name: string;
  size: number;
  content: File | string;
}
```

ESDropzoneDefaultOptions `type` property defines if ESDropzoneFile `content` property will be `base64` or `binary`.

```ts
interface ESDropzoneDefaultOptions {
  accept?: string;
  svgIcon?: string;
  maxSize?: number;
  type?: 'base64' | 'binary';
  headingTypography?: string;
  subheadingTypography?: string;
}
```

```ts
interface ESDropzoneValidationError {
  fileName: string;
  error: 'FILE_TYPE' | 'FILE_SIZE';
}
```

Injection token that can be used to configure the default options for all components within an app.

```ts
import { ES_DROPZONE_DEFAULT_OPTIONS } from '@elonsoft/elonkit/ui/dropzone';

@NgModule({
  providers: [
    {
      provide: ES_DROPZONE_DEFAULT_OPTIONS,
      useValue: {
        accept: 'image/png,image/jpg,image/jpeg',
        svgIcon: 'upload',
        maxSize: 50,
        type: 'binary'
      }
    }
  ]
})
```
